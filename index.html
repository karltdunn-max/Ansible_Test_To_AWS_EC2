<!DOCTYPE html>
<html>
<head>
  <title>DevOps Control Dashboard</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: Consolas, monospace;
      margin: 0;
      padding: 20px;
    }
    .container {
      display: flex;
      gap: 20px;
    }
    .panel {
      width: 50%;
      background: #1a1a1a;
      border: 1px solid #333;
      padding: 15px;
      border-radius: 6px;
    }
    button {
      background: #444;
      color: #fff;
      padding: 10px 15px;
      border: none;
      cursor: pointer;
      margin-bottom: 10px;
      border-radius: 4px;
    }
    button:hover {
      background: #555;
    }
    pre {
      background: #000;
      padding: 10px;
      height: 400px;
      overflow-y: auto;
      border-radius: 4px;
      border: 1px solid #333;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

<h1>DevOps Control Dashboard</h1>

<div class="container">

  <div class="panel">
    <h2>Master-Node — Nginx Management</h2>
    <button onclick="runAnsibleRestart()">Restart Nginx</button>
    <button onclick="clearOutput()">Clear Logs</button>
    <button onclick="killNginx()" style="background: #c0392b;">Kill Nginx (Test Status)</button>
    <pre id="ansible_output">Waiting...</pre>
  </div>

  <div class="panel">
    <h2>EC2 — NGINX Status</h2>
    <button onclick="refreshEC2()" style="background: #2980b9;">Check Nginx Status</button>
    <pre id="ec2_output">Click button to check status...</pre>
  </div>

</div>

<script>
const VM_IP = "98.88.23.115";

function runAnsibleRestart() {
  document.getElementById("ansible_output").textContent = "Running Ansible Playbook...";
  fetch(`http://${VM_IP}:5000/run?cmd=ec2-user_ansible`)
    .then(r => r.text()) // Using .text() as JSON was removed
    .then(t => {
      document.getElementById("ansible_output").textContent = t;
    })
    .catch(e => document.getElementById("ansible_output").textContent = "Error: " + e);
}



function killNginx() {
  if(confirm("Stop Nginx on remote EC2?")) {
    fetch(`http://${VM_IP}:5000/test/kill-nginx`)
      .then(r => r.text())
      .then(t => {
        alert(t);
        // We don't call refreshEC2() here automatically anymore to keep it manual
      })
      .catch(e => alert("Error: " + e));
  }
}

function clearOutput() {
  document.getElementById("ansible_output").textContent = "Waiting...";
  document.getElementById("ec2_output").textContent = "Logs cleared.";
}

function refreshEC2() {
  document.getElementById("ec2_output").textContent = "Checking Nginx Status...";
  // This calls the 'nginx_status' logic in your app.py
  fetch(`http://${VM_IP}:5000/run?cmd=nginx_status`)
    .then(r => r.text())
    .then(t => {
      document.getElementById("ec2_output").textContent = t;
    })
    .catch(e => document.getElementById("ec2_output").textContent = "Error: " + e);
}



// Auto-refresh is fully disabled (commented out)
// setInterval(refreshEC2, 10000);
</script>

</body>
</html>
